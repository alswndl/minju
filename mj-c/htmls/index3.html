<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë­ì»¤ìŠ¤: ë°±ì˜ ìë¦¬ë¡œ ê°€ëŠ” ê¸¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        /* ë³´ë“œíŒ ê·¸ë¦¬ë“œ ì„¤ì • */
        .board-grid {
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            min-width: 600px; /* ìŠ¤í¬ë¡¤ì„ ìœ„í•´ ìµœì†Œ ë„ˆë¹„ ì„¤ì • */
            min-height: 600px; /* ìŠ¤í¬ë¡¤ì„ ìœ„í•´ ìµœì†Œ ë†’ì´ ì„¤ì • */
        }
        .board-cell {
            padding: 0.75rem; /* ì¹¸ ë‚´ë¶€ ì—¬ë°±ì„ ë„“í˜€ ê¸€ì”¨ê°€ ê²¹ì¹˜ì§€ ì•Šê²Œ í•¨ */
        }
        /* í™€ìˆ˜ í–‰ì˜ ì¹¸ë“¤ì„ ë’¤ì§‘ì–´ ì§€ê·¸ì¬ê·¸ íŒ¨í„´ì„ ë§Œë“­ë‹ˆë‹¤ */
        .board-cell.reverse-row {
            transform: scaleX(-1);
        }
        /* ë’¤ì§‘íŒ ì¹¸ ì•ˆì˜ ë‚´ìš©(ê¸€ì”¨, ì•„ì´ì½˜)ì„ ë‹¤ì‹œ ë’¤ì§‘ì–´ ì •ìƒì ìœ¼ë¡œ ë³´ì´ê²Œ í•©ë‹ˆë‹¤ */
        .board-cell.reverse-row > * {
            transform: scaleX(-1);
        }
        /* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì»¨í…Œì´ë„ˆ */
        .scrollable-container {
            overflow: auto;
            max-width: 100%;
            aspect-ratio: 1 / 1;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full flex flex-col lg:flex-row gap-8 items-center lg:items-start">
        <div class="flex-grow flex flex-col items-center">
            
            <!-- ìŠ¤í¬ë¡¤ ê¸°ëŠ¥ì„ ìœ„í•œ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆ ì¶”ê°€ -->
            <div class="scrollable-container bg-blue-200 rounded-xl shadow-lg relative p-2">
                <div id="board" class="board-grid grid w-full mx-auto aspect-square">
                    <!-- Board cells will be generated by JavaScript -->
                </div>
            </div>
            
            <div id="game-info" class="bg-blue-100 rounded-xl p-4 mt-6 w-full mx-auto text-center text-gray-700 font-semibold text-lg shadow-inner">
                ê²Œì„ ì‹œì‘! ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ì£¼ì„¸ìš”.
            </div>
        </div>

        <div class="lg:w-1/3 w-full flex flex-col gap-4">
            <div class="bg-white rounded-2xl p-6 shadow-lg border border-blue-200">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">í”Œë ˆì´ì–´ ì •ë³´</h2>
                    <div id="current-player-display" class="bg-blue-500 text-white text-sm font-bold px-3 py-1 rounded-full">í”Œë ˆì´ì–´ 1 í„´</div>
                </div>
                <div id="players-status" class="space-y-3">
                    <!-- Player status will be updated by JavaScript -->
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-lg border border-blue-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">ê²Œì„ ì»¨íŠ¸ë¡¤</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="roll-dice-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-blue-700 transition-colors flex-grow">
                        ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸°
                    </button>
                    <button id="reset-game-btn" class="bg-gray-400 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-gray-500 transition-colors flex-grow">
                        ê²Œì„ ì¬ì‹œì‘
                    </button>
                </div>
            </div>

            <div id="mission-card-display" class="bg-yellow-100 text-yellow-800 rounded-2xl p-4 text-center font-bold shadow-inner hidden">
                <!-- Mission card text will appear here -->
            </div>

            <div id="winner-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
                <div class="bg-white rounded-3xl p-8 text-center shadow-2xl animate-fade-in">
                    <h3 id="winner-text" class="text-4xl font-extrabold text-blue-700 mb-4"></h3>
                    <p class="text-xl text-gray-600 mb-6">ê²Œì„ì„ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤! ì¶•í•˜í•©ë‹ˆë‹¤!</p>
                    <button id="close-modal-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-blue-700 transition-colors">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ë³´ë“œíŒì˜ íŠ¹ìˆ˜ íš¨ê³¼ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
        const boardEffects = {
            prime: "ì†Œìˆ˜! í•œ ë²ˆ ë” êµ´ë¦½ë‹ˆë‹¤.",
            multipleOf10: "10ì˜ ë°°ìˆ˜! ë’¤ë¡œ 5ì¹¸ ì´ë™í•©ë‹ˆë‹¤.",
            multipleOf5: "5ì˜ ë°°ìˆ˜! ì•ìœ¼ë¡œ 2ì¹¸ ì´ë™í•©ë‹ˆë‹¤.",
            missionCard: "ë¯¸ì…˜ ì¹´ë“œ ë½‘ê¸°!"
        };
        
        // ë¯¸ì…˜ ì¹´ë“œ ëª©ë¡ì„ ì •ì˜í•©ë‹ˆë‹¤.
        const missionCards = [
            { description: "ë‹¤ìŒ í„´ì— ì§ìˆ˜ë§Œ ì´ë™ ê°€ëŠ¥", action: (p) => p.evenOnly = true },
            { description: "ë‹¤ìŒ í„´ì— í™€ìˆ˜ë§Œ ì´ë™ ê°€ëŠ¥", action: (p) => p.oddOnly = true },
            { description: "ë‹¤ìŒ í„´ì— ì´ë™í•œ ê±°ë¦¬ë§Œí¼ ë˜ëŒì•„ê°", action: (p) => p.revertMove = true },
            { description: "ë‹¤ìŒ í„´ì— í„´ì„ í•œ ë²ˆ ì‰½ë‹ˆë‹¤.", action: (p) => p.skipTurn = true },
            { description: "ì•ìœ¼ë¡œ 3ì¹¸ ì´ë™í•©ë‹ˆë‹¤.", action: (p) => p.move(3) },
            { description: "ë’¤ë¡œ 3ì¹¸ ì´ë™í•©ë‹ˆë‹¤.", action: (p) => p.move(-3) },
        ];

        // í”Œë ˆì´ì–´ í´ë˜ìŠ¤ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
        class Player {
            constructor(name, color) {
                this.name = name;
                this.color = color;
                this.position = 0;
                this.skipTurn = false;
                this.extraTurn = false;
                this.evenOnly = false;
                this.oddOnly = false;
                this.revertMove = false;
            }

            move(distance) {
                this.position += distance;
                if (this.position < 0) {
                    this.position = 0;
                }
                return this.position;
            }
        }
        
        let players = [];
        let currentPlayerIndex = 0;

        function isPrime(num) {
            if (num <= 1) return false;
            for (let i = 2; i <= Math.sqrt(num); i++) {
                if (num % i === 0) return false;
            }
            return true;
        }

        // ë³´ë“œíŒì„ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê³  ë Œë”ë§í•©ë‹ˆë‹¤.
        function renderBoard() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            for (let i = 100; i >= 1; i--) {
                const cell = document.createElement('div');
                cell.id = `cell-${i}`;
                cell.className = `board-cell relative flex flex-col items-center justify-center w-full h-full text-center font-bold border border-blue-300 rounded-lg shadow-sm transition-all duration-300 transform scale-100`;
                
                const numberSpan = document.createElement('span');
                numberSpan.textContent = i;
                numberSpan.className = "text-xl";

                const effectSpan = document.createElement('span');
                effectSpan.className = "text-xs mt-1";

                // 100ë²ˆ ì¹¸ì˜ ê²½ìš° íŠ¹ë³„íˆ ì²˜ë¦¬
                if (i === 100) {
                    cell.classList.add('bg-blue-400', 'text-white');
                    effectSpan.textContent = ""; // ê¸€ì”¨ ì‚­ì œ
                } else if (i % 10 === 0) {
                    cell.classList.add('bg-red-400', 'text-white');
                    effectSpan.textContent = "â†5";
                } else if (i % 5 === 0) {
                    cell.classList.add('bg-green-400', 'text-white');
                    effectSpan.textContent = "â†’2";
                } else if (isPrime(i)) {
                    cell.classList.add('bg-yellow-300', 'text-yellow-900');
                    effectSpan.textContent = "í•œë²ˆë”";
                } else {
                    cell.classList.add('bg-white');
                }

                cell.appendChild(numberSpan);
                cell.appendChild(effectSpan);
                
                if (i % 15 === 0) {
                    const missionIcon = document.createElement('span');
                    missionIcon.className = "absolute top-1 right-1 text-base text-purple-600";
                    missionIcon.textContent = "ğŸƒ";
                    cell.appendChild(missionIcon);
                }

                // ì§€ê·¸ì¬ê·¸ íŒ¨í„´ êµ¬í˜„
                const row = Math.floor((100 - i) / 10);
                if (row % 2 !== 0) {
                    cell.classList.add('reverse-row');
                }
                
                boardEl.appendChild(cell);
            }
        }

        // í”Œë ˆì´ì–´ ìƒíƒœë¥¼ í™”ë©´ì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        function updatePlayerStatus() {
            const playersStatusEl = document.getElementById('players-status');
            playersStatusEl.innerHTML = '';
            players.forEach((p, index) => {
                const statusEl = document.createElement('div');
                statusEl.className = `flex items-center gap-2 p-3 rounded-lg ${index === currentPlayerIndex ? 'bg-blue-200 shadow-md' : 'bg-gray-100'}`;
                
                const piece = document.createElement('div');
                piece.className = `w-4 h-4 rounded-full ${p.color}`;
                statusEl.appendChild(piece);

                const nameEl = document.createElement('div');
                nameEl.className = "font-semibold text-gray-800 flex-grow";
                nameEl.textContent = p.name;
                statusEl.appendChild(nameEl);
                
                const positionEl = document.createElement('div');
                positionEl.className = "font-bold text-blue-600";
                positionEl.textContent = `ìœ„ì¹˜: ${p.position}`;
                statusEl.appendChild(positionEl);
                
                playersStatusEl.appendChild(statusEl);
            });

            document.getElementById('current-player-display').textContent = `${players[currentPlayerIndex].name} í„´`;
        }

        // ë§ì„ ë³´ë“œíŒì— ë Œë”ë§í•©ë‹ˆë‹¤.
        function renderPieces() {
            // ëª¨ë“  ë§ ì œê±°
            document.querySelectorAll('.player-piece').forEach(p => p.remove());

            players.forEach(p => {
                const cell = document.getElementById(`cell-${p.position}`);
                if (cell) {
                    const piece = document.createElement('div');
                    piece.className = `player-piece absolute w-5 h-5 rounded-full z-10 -translate-x-1/2 -translate-y-1/2 ${p.color} border-2 border-white transition-all duration-500 ease-in-out shadow-md`;
                    piece.style.left = '50%';
                    piece.style.bottom = '50%';
                    
                    // ì—¬ëŸ¬ ëª…ì˜ í”Œë ˆì´ì–´ê°€ ê°™ì€ ì¹¸ì— ìˆì„ ê²½ìš° ê²¹ì¹˜ì§€ ì•Šê²Œ ìœ„ì¹˜ ì¡°ì •
                    const piecesInCell = cell.querySelectorAll('.player-piece').length;
                    if (piecesInCell > 0) {
                        piece.style.transform = `translateX(${-50 + piecesInCell * 15}%) translateY(${-50 + piecesInCell * 15}%)`;
                    }
                    cell.appendChild(piece);
                }
            });
        }

        // ê²Œì„ ì§„í–‰ ë©”ì‹œì§€ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
        function updateGameInfo(message) {
            document.getElementById('game-info').textContent = message;
        }

        // ì£¼ì‚¬ìœ„ êµ´ë¦¬ê¸° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        document.getElementById('roll-dice-btn').addEventListener('click', () => {
            const player = players[currentPlayerIndex];

            // ë¯¸ì…˜ ì¹´ë“œ íš¨ê³¼ (í„´ ê±´ë„ˆë›°ê¸°)
            if (player.skipTurn) {
                updateGameInfo(`${player.name}ë‹˜ì€ ë¯¸ì…˜ ì¹´ë“œ íš¨ê³¼ë¡œ ì´ë²ˆ í„´ì„ ì‰½ë‹ˆë‹¤.`);
                player.skipTurn = false;
                nextTurn();
                return;
            }

            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 3) + 1;
            const totalRoll = dice1 + dice2;
            
            updateGameInfo(`${player.name}ë‹˜ì´ ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦½ë‹ˆë‹¤... ì¼ë°˜: ${dice1}, íŠ¹ìˆ˜: ${dice2}. ì´í•©: ${totalRoll}!`);
            
            // ë¯¸ì…˜ ì¹´ë“œ íš¨ê³¼ (ì§ìˆ˜/í™€ìˆ˜ë§Œ ì´ë™)
            if (player.evenOnly && totalRoll % 2 !== 0) {
                updateGameInfo(`âŒ ë¯¸ì…˜ ì¹´ë“œ ì¡°ê±´(ì§ìˆ˜ë§Œ ì´ë™) ë¶ˆì¼ì¹˜! ${player.name}ë‹˜ì˜ í„´ì´ ì¢…ë£Œë©ë‹ˆë‹¤.`);
                player.evenOnly = false;
                setTimeout(nextTurn, 1500);
                return;
            }
            if (player.oddOnly && totalRoll % 2 === 0) {
                updateGameInfo(`âŒ ë¯¸ì…˜ ì¹´ë“œ ì¡°ê±´(í™€ìˆ˜ë§Œ ì´ë™) ë¶ˆì¼ì¹˜! ${player.name}ë‹˜ì˜ í„´ì´ ì¢…ë£Œë©ë‹ˆë‹¤.`);
                player.oddOnly = false;
                setTimeout(nextTurn, 1500);
                return;
            }

            // í”Œë ˆì´ì–´ ì´ë™
            const oldPosition = player.position;
            player.move(totalRoll);
            updateGameInfo(`${player.name}ë‹˜ì´ ${oldPosition}ì—ì„œ ${totalRoll}ì¹¸ ì´ë™í•˜ì—¬ ${player.position}ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.`);

            // ë¯¸ì…˜ ì¹´ë“œ íš¨ê³¼ (ì´ë™ ê±°ë¦¬ ë˜ëŒë¦¬ê¸°)
            if (player.revertMove) {
                player.move(-totalRoll);
                updateGameInfo(`ğŸ”™ ë¯¸ì…˜ ì¹´ë“œ íš¨ê³¼ë¡œ ${totalRoll}ì¹¸ ë˜ëŒì•„ê°‘ë‹ˆë‹¤. í˜„ì¬ ìœ„ì¹˜: ${player.position}`);
                player.revertMove = false;
            }
            
            renderPieces();
            updatePlayerStatus();

            setTimeout(() => {
                // ê²Œì„ ì¢…ë£Œ ì¡°ê±´ í™•ì¸
                if (player.position >= 100) {
                    endGame(player);
                    return;
                }
                
                // ë³´ë“œíŒ íŠ¹ìˆ˜ íš¨ê³¼ ì ìš©
                applyBoardEffect(player);

                // ë¯¸ì…˜ ì¹´ë“œ ë½‘ê¸° (15ì˜ ë°°ìˆ˜ ì¹¸ì— ë„ì°©í•˜ë©´)
                if (player.position % 15 === 0 && player.position !== 0) {
                    drawMissionCard(player);
                }

                // ì¶”ê°€ í„´ í™•ì¸
                if (player.extraTurn) {
                    updateGameInfo("â­ ì¶”ê°€ í„´ì„ ì–»ì—ˆìŠµë‹ˆë‹¤! ë‹¤ì‹œ êµ´ë ¤ì£¼ì„¸ìš”.");
                    player.extraTurn = false;
                } else {
                    nextTurn();
                }
            }, 1500);
        });

        // ë³´ë“œíŒ íš¨ê³¼ ì ìš© í•¨ìˆ˜
        function applyBoardEffect(player) {
            const pos = player.position;
            
            // 100ë²ˆ ì¹¸ì—ì„œëŠ” íš¨ê³¼ë¥¼ ì ìš©í•˜ì§€ ì•ŠìŒ
            if (pos >= 100) return;
            
            let message = "";
            if (isPrime(pos)) {
                message = `â­ ${pos}ì¹¸ì€ ì†Œìˆ˜ì…ë‹ˆë‹¤! í•œ ë²ˆ ë” ì£¼ì‚¬ìœ„ë¥¼ êµ´ë¦½ë‹ˆë‹¤.`;
                player.extraTurn = true;
            } else if (pos % 10 === 0) {
                message = `â­ ${pos}ì¹¸ì— ë„ì°©! 10ì˜ ë°°ìˆ˜! ë’¤ë¡œ 5ì¹¸ ì´ë™í•©ë‹ˆë‹¤.`;
                player.move(-5);
                renderPieces();
                updatePlayerStatus();
            } else if (pos % 5 === 0) {
                message = `â­ ${pos}ì¹¸ì— ë„ì°©! 5ì˜ ë°°ìˆ˜! ì•ìœ¼ë¡œ 2ì¹¸ ì´ë™í•©ë‹ˆë‹¤.`;
                player.move(2);
                renderPieces();
                updatePlayerStatus();
            }
            if (message) {
                updateGameInfo(message);
            }
        }
        
        // ë¯¸ì…˜ ì¹´ë“œ ë½‘ê¸° í•¨ìˆ˜
        function drawMissionCard(player) {
            const missionDisplay = document.getElementById('mission-card-display');
            const card = missionCards[Math.floor(Math.random() * missionCards.length)];
            
            missionDisplay.textContent = `ğŸƒ ë¯¸ì…˜ ì¹´ë“œ! '${card.description}'`;
            missionDisplay.classList.remove('hidden');
            
            card.action(player);
        }
        
        // ë‹¤ìŒ í„´ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°
        function nextTurn() {
            const missionDisplay = document.getElementById('mission-card-display');
            missionDisplay.classList.add('hidden');
            
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            updatePlayerStatus();
            updateGameInfo(`${players[currentPlayerIndex].name}ë‹˜ì˜ í„´ì…ë‹ˆë‹¤. ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ì£¼ì„¸ìš”!`);
        }

        // ê²Œì„ ì¢…ë£Œ í•¨ìˆ˜
        function endGame(winner) {
            let message = "";
            let finalWinner = winner;
            if (winner.position === 100) {
                message = `${winner.name}ë‹˜ì´ ì •í™•íˆ 100ì— ë„ì°©í•˜ì—¬ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!`;
            } else {
                let closestDistance = Infinity;
                players.forEach(p => {
                    const distance = Math.abs(100 - p.position);
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        finalWinner = p;
                    }
                });
                message = `${finalWinner.name}ë‹˜ì´ 100ì„ ë„˜ì–´ ê°€ì¥ ê°€ê¹Œìš´ ìœ„ì¹˜(${finalWinner.position})ì— ë„ë‹¬í•˜ì—¬ ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤!`;
            }
            
            document.getElementById('winner-text').textContent = message;
            document.getElementById('winner-modal').classList.remove('hidden');
            document.getElementById('roll-dice-btn').disabled = true;
        }

        // ê²Œì„ ì¬ì‹œì‘ ë²„íŠ¼
        document.getElementById('reset-game-btn').addEventListener('click', () => {
            initializeGame();
        });

        // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('winner-modal').classList.add('hidden');
        });

        // ê²Œì„ ì´ˆê¸°í™”
        function initializeGame() {
            players = [
                new Player("í”Œë ˆì´ì–´ 1", "bg-blue-600"),
                new Player("í”Œë ˆì´ì–´ 2", "bg-red-600"),
                new Player("í”Œë ˆì´ì–´ 3", "bg-green-600"),
                new Player("í”Œë ˆì´ì–´ 4", "bg-purple-600")
            ];
            currentPlayerIndex = 0;
            document.getElementById('roll-dice-btn').disabled = false;
            
            renderBoard();
            updatePlayerStatus();
            renderPieces();
            updateGameInfo("ê²Œì„ì´ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤! ì£¼ì‚¬ìœ„ë¥¼ êµ´ë ¤ì£¼ì„¸ìš”.");
        }

        window.onload = initializeGame;
    </script>
</body>
</html>
