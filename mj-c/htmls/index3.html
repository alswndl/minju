<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>랭커스: 백의 자리로 가는 길</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
        }
        /* 보드판 그리드 설정 */
        .board-grid {
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            min-width: 600px; /* 스크롤을 위해 최소 너비 설정 */
            min-height: 600px; /* 스크롤을 위해 최소 높이 설정 */
        }
        .board-cell {
            padding: 0.75rem; /* 칸 내부 여백을 넓혀 글씨가 겹치지 않게 함 */
        }
        /* 홀수 행의 칸들을 뒤집어 지그재그 패턴을 만듭니다 */
        .board-cell.reverse-row {
            transform: scaleX(-1);
        }
        /* 뒤집힌 칸 안의 내용(글씨, 아이콘)을 다시 뒤집어 정상적으로 보이게 합니다 */
        .board-cell.reverse-row > * {
            transform: scaleX(-1);
        }
        /* 스크롤 가능한 컨테이너 */
        .scrollable-container {
            overflow: auto;
            max-width: 100%;
            aspect-ratio: 1 / 1;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-3xl shadow-2xl p-8 w-full flex flex-col lg:flex-row gap-8 items-center lg:items-start">
        <div class="flex-grow flex flex-col items-center">
            
            <!-- 스크롤 기능을 위한 새로운 컨테이너 추가 -->
            <div class="scrollable-container bg-blue-200 rounded-xl shadow-lg relative p-2">
                <div id="board" class="board-grid grid w-full mx-auto aspect-square">
                    <!-- Board cells will be generated by JavaScript -->
                </div>
            </div>
            
            <div id="game-info" class="bg-blue-100 rounded-xl p-4 mt-6 w-full mx-auto text-center text-gray-700 font-semibold text-lg shadow-inner">
                게임 시작! 주사위를 굴려주세요.
            </div>
        </div>

        <div class="lg:w-1/3 w-full flex flex-col gap-4">
            <div class="bg-white rounded-2xl p-6 shadow-lg border border-blue-200">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold text-gray-800">플레이어 정보</h2>
                    <div id="current-player-display" class="bg-blue-500 text-white text-sm font-bold px-3 py-1 rounded-full">플레이어 1 턴</div>
                </div>
                <div id="players-status" class="space-y-3">
                    <!-- Player status will be updated by JavaScript -->
                </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow-lg border border-blue-200">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">게임 컨트롤</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="roll-dice-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-blue-700 transition-colors flex-grow">
                        주사위 굴리기
                    </button>
                    <button id="reset-game-btn" class="bg-gray-400 text-white font-bold py-3 px-6 rounded-xl shadow-lg hover:bg-gray-500 transition-colors flex-grow">
                        게임 재시작
                    </button>
                </div>
            </div>

            <div id="mission-card-display" class="bg-yellow-100 text-yellow-800 rounded-2xl p-4 text-center font-bold shadow-inner hidden">
                <!-- Mission card text will appear here -->
            </div>

            <div id="winner-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
                <div class="bg-white rounded-3xl p-8 text-center shadow-2xl animate-fade-in">
                    <h3 id="winner-text" class="text-4xl font-extrabold text-blue-700 mb-4"></h3>
                    <p class="text-xl text-gray-600 mb-6">게임을 승리했습니다! 축하합니다!</p>
                    <button id="close-modal-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-xl hover:bg-blue-700 transition-colors">닫기</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 보드판의 특수 효과를 정의합니다.
        const boardEffects = {
            prime: "소수! 한 번 더 굴립니다.",
            multipleOf10: "10의 배수! 뒤로 5칸 이동합니다.",
            multipleOf5: "5의 배수! 앞으로 2칸 이동합니다.",
            missionCard: "미션 카드 뽑기!"
        };
        
        // 미션 카드 목록을 정의합니다.
        const missionCards = [
            { description: "다음 턴에 짝수만 이동 가능", action: (p) => p.evenOnly = true },
            { description: "다음 턴에 홀수만 이동 가능", action: (p) => p.oddOnly = true },
            { description: "다음 턴에 이동한 거리만큼 되돌아감", action: (p) => p.revertMove = true },
            { description: "다음 턴에 턴을 한 번 쉽니다.", action: (p) => p.skipTurn = true },
            { description: "앞으로 3칸 이동합니다.", action: (p) => p.move(3) },
            { description: "뒤로 3칸 이동합니다.", action: (p) => p.move(-3) },
        ];

        // 플레이어 클래스를 정의합니다.
        class Player {
            constructor(name, color) {
                this.name = name;
                this.color = color;
                this.position = 0;
                this.skipTurn = false;
                this.extraTurn = false;
                this.evenOnly = false;
                this.oddOnly = false;
                this.revertMove = false;
            }

            move(distance) {
                this.position += distance;
                if (this.position < 0) {
                    this.position = 0;
                }
                return this.position;
            }
        }
        
        let players = [];
        let currentPlayerIndex = 0;

        function isPrime(num) {
            if (num <= 1) return false;
            for (let i = 2; i <= Math.sqrt(num); i++) {
                if (num % i === 0) return false;
            }
            return true;
        }

        // 보드판을 동적으로 생성하고 렌더링합니다.
        function renderBoard() {
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            for (let i = 100; i >= 1; i--) {
                const cell = document.createElement('div');
                cell.id = `cell-${i}`;
                cell.className = `board-cell relative flex flex-col items-center justify-center w-full h-full text-center font-bold border border-blue-300 rounded-lg shadow-sm transition-all duration-300 transform scale-100`;
                
                const numberSpan = document.createElement('span');
                numberSpan.textContent = i;
                numberSpan.className = "text-xl";

                const effectSpan = document.createElement('span');
                effectSpan.className = "text-xs mt-1";

                // 100번 칸의 경우 특별히 처리
                if (i === 100) {
                    cell.classList.add('bg-blue-400', 'text-white');
                    effectSpan.textContent = ""; // 글씨 삭제
                } else if (i % 10 === 0) {
                    cell.classList.add('bg-red-400', 'text-white');
                    effectSpan.textContent = "←5";
                } else if (i % 5 === 0) {
                    cell.classList.add('bg-green-400', 'text-white');
                    effectSpan.textContent = "→2";
                } else if (isPrime(i)) {
                    cell.classList.add('bg-yellow-300', 'text-yellow-900');
                    effectSpan.textContent = "한번더";
                } else {
                    cell.classList.add('bg-white');
                }

                cell.appendChild(numberSpan);
                cell.appendChild(effectSpan);
                
                if (i % 15 === 0) {
                    const missionIcon = document.createElement('span');
                    missionIcon.className = "absolute top-1 right-1 text-base text-purple-600";
                    missionIcon.textContent = "🃏";
                    cell.appendChild(missionIcon);
                }

                // 지그재그 패턴 구현
                const row = Math.floor((100 - i) / 10);
                if (row % 2 !== 0) {
                    cell.classList.add('reverse-row');
                }
                
                boardEl.appendChild(cell);
            }
        }

        // 플레이어 상태를 화면에 업데이트합니다.
        function updatePlayerStatus() {
            const playersStatusEl = document.getElementById('players-status');
            playersStatusEl.innerHTML = '';
            players.forEach((p, index) => {
                const statusEl = document.createElement('div');
                statusEl.className = `flex items-center gap-2 p-3 rounded-lg ${index === currentPlayerIndex ? 'bg-blue-200 shadow-md' : 'bg-gray-100'}`;
                
                const piece = document.createElement('div');
                piece.className = `w-4 h-4 rounded-full ${p.color}`;
                statusEl.appendChild(piece);

                const nameEl = document.createElement('div');
                nameEl.className = "font-semibold text-gray-800 flex-grow";
                nameEl.textContent = p.name;
                statusEl.appendChild(nameEl);
                
                const positionEl = document.createElement('div');
                positionEl.className = "font-bold text-blue-600";
                positionEl.textContent = `위치: ${p.position}`;
                statusEl.appendChild(positionEl);
                
                playersStatusEl.appendChild(statusEl);
            });

            document.getElementById('current-player-display').textContent = `${players[currentPlayerIndex].name} 턴`;
        }

        // 말을 보드판에 렌더링합니다.
        function renderPieces() {
            // 모든 말 제거
            document.querySelectorAll('.player-piece').forEach(p => p.remove());

            players.forEach(p => {
                const cell = document.getElementById(`cell-${p.position}`);
                if (cell) {
                    const piece = document.createElement('div');
                    piece.className = `player-piece absolute w-5 h-5 rounded-full z-10 -translate-x-1/2 -translate-y-1/2 ${p.color} border-2 border-white transition-all duration-500 ease-in-out shadow-md`;
                    piece.style.left = '50%';
                    piece.style.bottom = '50%';
                    
                    // 여러 명의 플레이어가 같은 칸에 있을 경우 겹치지 않게 위치 조정
                    const piecesInCell = cell.querySelectorAll('.player-piece').length;
                    if (piecesInCell > 0) {
                        piece.style.transform = `translateX(${-50 + piecesInCell * 15}%) translateY(${-50 + piecesInCell * 15}%)`;
                    }
                    cell.appendChild(piece);
                }
            });
        }

        // 게임 진행 메시지를 업데이트합니다.
        function updateGameInfo(message) {
            document.getElementById('game-info').textContent = message;
        }

        // 주사위 굴리기 이벤트 핸들러
        document.getElementById('roll-dice-btn').addEventListener('click', () => {
            const player = players[currentPlayerIndex];

            // 미션 카드 효과 (턴 건너뛰기)
            if (player.skipTurn) {
                updateGameInfo(`${player.name}님은 미션 카드 효과로 이번 턴을 쉽니다.`);
                player.skipTurn = false;
                nextTurn();
                return;
            }

            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 3) + 1;
            const totalRoll = dice1 + dice2;
            
            updateGameInfo(`${player.name}님이 주사위를 굴립니다... 일반: ${dice1}, 특수: ${dice2}. 총합: ${totalRoll}!`);
            
            // 미션 카드 효과 (짝수/홀수만 이동)
            if (player.evenOnly && totalRoll % 2 !== 0) {
                updateGameInfo(`❌ 미션 카드 조건(짝수만 이동) 불일치! ${player.name}님의 턴이 종료됩니다.`);
                player.evenOnly = false;
                setTimeout(nextTurn, 1500);
                return;
            }
            if (player.oddOnly && totalRoll % 2 === 0) {
                updateGameInfo(`❌ 미션 카드 조건(홀수만 이동) 불일치! ${player.name}님의 턴이 종료됩니다.`);
                player.oddOnly = false;
                setTimeout(nextTurn, 1500);
                return;
            }

            // 플레이어 이동
            const oldPosition = player.position;
            player.move(totalRoll);
            updateGameInfo(`${player.name}님이 ${oldPosition}에서 ${totalRoll}칸 이동하여 ${player.position}에 도착했습니다.`);

            // 미션 카드 효과 (이동 거리 되돌리기)
            if (player.revertMove) {
                player.move(-totalRoll);
                updateGameInfo(`🔙 미션 카드 효과로 ${totalRoll}칸 되돌아갑니다. 현재 위치: ${player.position}`);
                player.revertMove = false;
            }
            
            renderPieces();
            updatePlayerStatus();

            setTimeout(() => {
                // 게임 종료 조건 확인
                if (player.position >= 100) {
                    endGame(player);
                    return;
                }
                
                // 보드판 특수 효과 적용
                applyBoardEffect(player);

                // 미션 카드 뽑기 (15의 배수 칸에 도착하면)
                if (player.position % 15 === 0 && player.position !== 0) {
                    drawMissionCard(player);
                }

                // 추가 턴 확인
                if (player.extraTurn) {
                    updateGameInfo("⭐ 추가 턴을 얻었습니다! 다시 굴려주세요.");
                    player.extraTurn = false;
                } else {
                    nextTurn();
                }
            }, 1500);
        });

        // 보드판 효과 적용 함수
        function applyBoardEffect(player) {
            const pos = player.position;
            
            // 100번 칸에서는 효과를 적용하지 않음
            if (pos >= 100) return;
            
            let message = "";
            if (isPrime(pos)) {
                message = `⭐ ${pos}칸은 소수입니다! 한 번 더 주사위를 굴립니다.`;
                player.extraTurn = true;
            } else if (pos % 10 === 0) {
                message = `⭐ ${pos}칸에 도착! 10의 배수! 뒤로 5칸 이동합니다.`;
                player.move(-5);
                renderPieces();
                updatePlayerStatus();
            } else if (pos % 5 === 0) {
                message = `⭐ ${pos}칸에 도착! 5의 배수! 앞으로 2칸 이동합니다.`;
                player.move(2);
                renderPieces();
                updatePlayerStatus();
            }
            if (message) {
                updateGameInfo(message);
            }
        }
        
        // 미션 카드 뽑기 함수
        function drawMissionCard(player) {
            const missionDisplay = document.getElementById('mission-card-display');
            const card = missionCards[Math.floor(Math.random() * missionCards.length)];
            
            missionDisplay.textContent = `🃏 미션 카드! '${card.description}'`;
            missionDisplay.classList.remove('hidden');
            
            card.action(player);
        }
        
        // 다음 턴으로 넘어가기
        function nextTurn() {
            const missionDisplay = document.getElementById('mission-card-display');
            missionDisplay.classList.add('hidden');
            
            currentPlayerIndex = (currentPlayerIndex + 1) % players.length;
            updatePlayerStatus();
            updateGameInfo(`${players[currentPlayerIndex].name}님의 턴입니다. 주사위를 굴려주세요!`);
        }

        // 게임 종료 함수
        function endGame(winner) {
            let message = "";
            let finalWinner = winner;
            if (winner.position === 100) {
                message = `${winner.name}님이 정확히 100에 도착하여 승리했습니다!`;
            } else {
                let closestDistance = Infinity;
                players.forEach(p => {
                    const distance = Math.abs(100 - p.position);
                    if (distance < closestDistance) {
                        closestDistance = distance;
                        finalWinner = p;
                    }
                });
                message = `${finalWinner.name}님이 100을 넘어 가장 가까운 위치(${finalWinner.position})에 도달하여 승리했습니다!`;
            }
            
            document.getElementById('winner-text').textContent = message;
            document.getElementById('winner-modal').classList.remove('hidden');
            document.getElementById('roll-dice-btn').disabled = true;
        }

        // 게임 재시작 버튼
        document.getElementById('reset-game-btn').addEventListener('click', () => {
            initializeGame();
        });

        // 모달 닫기 버튼
        document.getElementById('close-modal-btn').addEventListener('click', () => {
            document.getElementById('winner-modal').classList.add('hidden');
        });

        // 게임 초기화
        function initializeGame() {
            players = [
                new Player("플레이어 1", "bg-blue-600"),
                new Player("플레이어 2", "bg-red-600"),
                new Player("플레이어 3", "bg-green-600"),
                new Player("플레이어 4", "bg-purple-600")
            ];
            currentPlayerIndex = 0;
            document.getElementById('roll-dice-btn').disabled = false;
            
            renderBoard();
            updatePlayerStatus();
            renderPieces();
            updateGameInfo("게임이 재시작되었습니다! 주사위를 굴려주세요.");
        }

        window.onload = initializeGame;
    </script>
</body>
</html>
